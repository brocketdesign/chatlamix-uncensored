<!DOCTYPE html>
<html>
{{> dashboard-header}}
<body class="bg-dark">
    {{> dashboard-nav}}
    <link rel="stylesheet" href="/css/dashboard-posts.css">
    <link rel="stylesheet" href="/css/dashboard-schedules.css">

    <section class="container-fluid py-4 schedules-page">
        <!-- Header -->
        <div class="row mb-4 schedules-header">
            <div class="col-12">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                    <div class="flex-grow-1">
                        <h1 class="text-white mb-1">
                            <i class="bi bi-calendar-event me-2"></i>{{translations.dashboard.mySchedules}}
                        </h1>
                        <p class="text-muted mb-0">{{translations.dashboard.mySchedulesDescription}}</p>
                    </div>
                    <div class="d-flex gap-2 w-100 w-md-auto">
                        <button class="btn btn-primary flex-fill flex-md-grow-0" onclick="schedulesDashboard.openCreateModal('single')">
                            <i class="bi bi-calendar-plus me-1"></i>{{translations.dashboard.newSchedule}}
                        </button>
                        <button class="btn btn-outline-secondary flex-fill flex-md-grow-0" onclick="schedulesDashboard.openCreateModal('recurring')">
                            <i class="bi bi-arrow-repeat me-1"></i>{{translations.dashboard.newCronJob}}
                        </button>
                        <button class="btn btn-outline-info flex-fill flex-md-grow-0" onclick="schedulesDashboard.openCalendarManager()">
                            <i class="bi bi-calendar-week me-1"></i>{{translations.dashboard.calendars}}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stats-card total">
                <div class="stats-card-icon">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <div class="stats-card-value" id="totalSchedules">0</div>
                <div class="stats-card-label">{{translations.dashboard.total}}</div>
            </div>
            <div class="stats-card active">
                <div class="stats-card-icon">
                    <i class="bi bi-play-circle"></i>
                </div>
                <div class="stats-card-value" id="activeSchedules">0</div>
                <div class="stats-card-label">{{translations.dashboard.active}}</div>
            </div>
            <div class="stats-card paused">
                <div class="stats-card-icon">
                    <i class="bi bi-pause-circle"></i>
                </div>
                <div class="stats-card-value" id="pausedSchedules">0</div>
                <div class="stats-card-label">{{translations.dashboard.paused}}</div>
            </div>
            <div class="stats-card completed">
                <div class="stats-card-icon">
                    <i class="bi bi-check-circle"></i>
                </div>
                <div class="stats-card-value" id="completedSchedules">0</div>
                <div class="stats-card-label">{{translations.dashboard.completed}}</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-card">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">{{translations.dashboard.type}}</label>
                    <select id="filterType" class="form-select">
                        <option value="">{{translations.dashboard.all}}</option>
                        <option value="single">{{translations.dashboard.singleSchedule}}</option>
                        <option value="recurring">{{translations.dashboard.recurringCron}}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{translations.dashboard.status}}</label>
                    <select id="filterStatus" class="form-select">
                        <option value="">{{translations.dashboard.all}}</option>
                        <option value="pending">{{translations.dashboard.pending}}</option>
                        <option value="active">{{translations.dashboard.active}}</option>
                        <option value="paused">{{translations.dashboard.paused}}</option>
                        <option value="completed">{{translations.dashboard.completed}}</option>
                        <option value="failed">{{translations.dashboard.failed}}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{translations.dashboard.action}}</label>
                    <select id="filterAction" class="form-select">
                        <option value="">{{translations.dashboard.all}}</option>
                        <option value="generate_image">{{translations.dashboard.generateImage}}</option>
                        <option value="generate_video">{{translations.dashboard.generateVideo}}</option>
                        <option value="publish_post">{{translations.dashboard.publishPost}}</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-outline-info w-100" id="resetFiltersBtn">
                        <i class="bi bi-arrow-clockwise me-1"></i>{{translations.dashboard.reset}}
                    </button>
                </div>
            </div>
        </div>

        <!-- Schedules List -->
        <div id="schedulesGrid" class="row g-4 mb-4">
            <!-- Schedules will be loaded here via JavaScript -->
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">{{translations.dashboard.loading}}</span>
            </div>
        </div>

        <!-- No Schedules Message -->
        <div id="noSchedules" class="text-center py-5" style="display: none;">
            <i class="bi bi-calendar-x"></i>
            <h3>{{translations.dashboard.noSchedules}}</h3>
            <p>{{translations.dashboard.noSchedulesDescription}}</p>
            <div class="d-flex justify-content-center gap-2 mt-3">
                <button class="btn btn-primary" onclick="schedulesDashboard.openCreateModal('single')">
                    <i class="bi bi-calendar-plus me-1"></i>{{translations.dashboard.createFirstSchedule}}
                </button>
            </div>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="d-flex justify-content-center mt-4"></div>
    </section>

    <!-- Create/Edit Schedule Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="false">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalTitle">
                        <i class="bi bi-calendar-plus me-2"></i>{{translations.dashboard.newSchedule}}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="scheduleId">
                    <input type="hidden" id="scheduleType" value="single">

                    <!-- Schedule Type Toggle -->
                    <div class="mb-4">
                        <label class="form-label">{{translations.dashboard.scheduleType}}</label>
                        <div class="segmented-control" role="group">
                            <input type="radio" class="btn-check" name="scheduleTypeRadio" id="typeSingle" value="single" checked>
                            <label class="segment-btn" for="typeSingle">
                                <i class="bi bi-calendar-event"></i>
                                <span>{{translations.dashboard.singleSchedule}}</span>
                            </label>
                            <input type="radio" class="btn-check" name="scheduleTypeRadio" id="typeRecurring" value="recurring">
                            <label class="segment-btn" for="typeRecurring">
                                <i class="bi bi-arrow-repeat"></i>
                                <span>{{translations.dashboard.recurringCron}}</span>
                            </label>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label class="form-label">{{translations.dashboard.description}}</label>
                        <input type="text" class="form-control" id="scheduleDescription" placeholder="{{translations.dashboard.scheduleDescriptionPlaceholder}}">
                    </div>

                    <!-- Action Type -->
                    <div class="mb-3">
                        <label class="form-label">{{translations.dashboard.actionType}}</label>
                        <div class="schedule-action-selector">
                            <button type="button" class="schedule-action-btn active" data-action="generate_image">
                                <i class="bi bi-images"></i>
                                <span>{{translations.dashboard.generateImage}}</span>
                            </button>
                            <button type="button" class="schedule-action-btn" data-action="generate_video">
                                <i class="bi bi-film"></i>
                                <span>{{translations.dashboard.generateVideo}}</span>
                            </button>
                            <button type="button" class="schedule-action-btn" data-action="publish_post">
                                <i class="bi bi-send-fill"></i>
                                <span>{{translations.dashboard.publishPost}}</span>
                            </button>
                        </div>
                        <input type="hidden" id="actionType" value="generate_image">
                        <div id="actionTypeDescription" class="action-type-description mt-2">
                            <small>
                                <i class="bi bi-info-circle me-1"></i>
                                <span id="actionTypeDescriptionText">{{translations.dashboard.generateImageDescription}}</span>
                            </small>
                        </div>
                    </div>

                    <!-- Single Schedule: Date/Time -->
                    <div id="singleScheduleFields">
                        <!-- Calendar Selection -->
                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.useCalendar}} <span class="text-muted">({{translations.dashboard.optional}})</span></label>
                            <div class="d-flex gap-2 align-items-start">
                                <select class="form-select" id="calendarSelect" style="flex: 1;">
                                    <option value="">{{translations.dashboard.manualTimeSelection}}</option>
                                    <!-- Calendars loaded dynamically -->
                                </select>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="schedulesDashboard.openCalendarManager()" title="Manage Calendars">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.calendarAutoFillHelp}}
                            </small>
                        </div>

                        <!-- Next Available Slot Preview -->
                        <div id="nextSlotPreview" class="mb-3" style="display: none;">
                            <div class="alert alert-info py-2 mb-0 d-flex align-items-center justify-content-between">
                                <div>
                                    <i class="bi bi-calendar-check me-2"></i>
                                    <span id="nextSlotText">{{translations.dashboard.nextSlotLoading}}</span>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-info" onclick="schedulesDashboard.useNextSlot()">
                                    {{translations.dashboard.useThisSlot}}
                                </button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.scheduledFor}}</label>
                            <input type="datetime-local" class="form-control" id="scheduledFor">
                        </div>
                    </div>

                    <!-- Recurring Schedule: Cron Expression -->
                    <div id="recurringScheduleFields" style="display: none;">
                        <!-- Calendar Selection for Recurring -->
                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.useCalendarOptionalReplacesCron}} <span class="text-muted">({{translations.dashboard.optionalReplacesCron}})</span></label>
                            <div class="d-flex gap-2 align-items-start">
                                <select class="form-select" id="recurringCalendarSelect" style="flex: 1;">
                                    <option value="">{{translations.dashboard.useCronExpressionInstead}}</option>
                                    <!-- Calendars loaded dynamically -->
                                </select>
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="schedulesDashboard.openCalendarManager()" title="Manage Calendars">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.calendarWeeklySlotsHelp}}
                            </small>
                        </div>

                        <!-- Next Available Slot Preview for Recurring -->
                        <div id="recurringNextSlotPreview" class="mb-3" style="display: none;">
                            <div class="alert alert-success py-2 mb-0">
                                <span id="recurringNextSlotText">{{translations.dashboard.calendarPublishAtSlots}}</span>
                            </div>
                        </div>

                        <!-- Cron Expression (hidden when calendar selected) -->
                        <div id="cronExpressionSection">
                            <div class="mb-3">
                                <label class="form-label">{{translations.dashboard.cronExpression}}</label>
                                <input type="text" class="form-control" id="cronExpression" placeholder="0 9 * * *">
                                <small class="text-muted">{{translations.dashboard.cronExpressionHelp}}</small>
                            </div>
                            <div class="mb-3 cron-presets">
                                <label class="form-label">{{translations.dashboard.cronPresets}}</label>
                                <div class="d-flex flex-wrap gap-2">
                                    <button type="button" class="btn btn-sm" onclick="setCronPreset('0 9 * * *')">{{translations.dashboard.daily9AM}}</button>
                                    <button type="button" class="btn btn-sm" onclick="setCronPreset('0 */6 * * *')">{{translations.dashboard.every6Hours}}</button>
                                    <button type="button" class="btn btn-sm" onclick="setCronPreset('0 12 * * 1-5')">{{translations.dashboard.weekdaysNoon}}</button>
                                    <button type="button" class="btn btn-sm" onclick="setCronPreset('0 10 * * 6,0')">{{translations.dashboard.weekends10AM}}</button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">{{translations.dashboard.maxExecutions}}</label>
                                <input type="number" class="form-control" id="maxExecutions" placeholder="{{translations.dashboard.unlimited}}" min="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">{{translations.dashboard.endDate}}</label>
                                <input type="date" class="form-control" id="endDate">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="mutationEnabled">
                                <label class="form-check-label" for="mutationEnabled">
                                    {{translations.dashboard.enablePromptMutation}}
                                </label>
                                <small class="text-muted d-block">{{translations.dashboard.mutationHelp}}</small>
                            </div>
                        </div>
                    </div>

                    <!-- Character Selection -->
                    <div class="mb-3">
                        <label class="form-label">{{translations.dashboard.character}} <span class="text-muted">({{translations.dashboard.optional}})</span></label>
                        <div class="character-search-wrapper">
                            <i class="bi bi-search character-search-icon"></i>
                            <input type="text" id="characterSearchInput" class="character-search-input" placeholder="{{translations.dashboard.searchCharacters}}">
                        </div>
                        <div id="characterSelectionContainer" class="character-selection-list">
                            <!-- Characters loaded dynamically -->
                            <div class="text-center py-3">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">{{translations.dashboard.loading}}</span>
                                </div>
                                <p class="text-muted mt-2 mb-0 small">{{translations.dashboard.loadingCharacters}}</p>
                            </div>
                        </div>
                        <small class="text-muted">
                            <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.characterStylingHelp}}
                        </small>
                    </div>

                    <!-- Prompt Type Selection -->
                    <div class="mb-3">
                        <label class="form-label">{{translations.dashboard.promptType}}</label>
                        <div class="segmented-control" role="group">
                            <input type="radio" class="btn-check" name="promptTypeRadio" id="promptTypeManual" value="manual" checked>
                            <label class="segment-btn" for="promptTypeManual">
                                <i class="bi bi-pencil"></i>
                                <span>{{translations.dashboard.manualPrompt}}</span>
                            </label>
                            <input type="radio" class="btn-check" name="promptTypeRadio" id="promptTypeCustom" value="custom">
                            <label class="segment-btn" for="promptTypeCustom">
                                <i class="bi bi-collection"></i>
                                <span>{{translations.dashboard.customPrompts}}</span>
                            </label>
                        </div>
                        <small class="text-muted d-block mt-1">
                            <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.promptTypeHelp}}
                        </small>
                    </div>

                    <!-- Manual Prompt Fields -->
                    <div id="manualPromptFields">
                        <!-- Action Data: Prompt -->
                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.prompt}}</label>
                            <textarea class="form-control" id="actionPrompt" rows="8" placeholder="{{translations.dashboard.promptPlaceholder}}"></textarea>
                        </div>
                    </div>

                    <!-- Custom Prompts Selection -->
                    <div id="customPromptFields" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.selectCustomPrompts}}</label>
                            <div id="customPromptsContainer" class="custom-prompts-grid">
                                <!-- Custom prompts loaded dynamically -->
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">{{translations.dashboard.loading}}</span>
                                    </div>
                                    <p class="text-muted mt-2 mb-0 small">{{translations.dashboard.loadingCustomPrompts}}</p>
                                </div>
                            </div>
                            <small class="text-muted d-block mt-2">
                                <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.customPromptsHelp}}
                            </small>
                            <div id="selectedPromptsInfo" class="mt-2" style="display: none;">
                                <span class="schedule-status-badge pending">
                                    <span id="selectedPromptsCount">0</span> {{translations.dashboard.promptsSelected}}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Data: Model -->
                    <div class="mb-3" id="modelSelectorSection">
                        <label class="form-label">{{translations.dashboard.model}}</label>
                        <button type="button" class="schedule-model-selector" id="modelSelectorBtn">
                            <div class="model-icon">
                                <i class="bi bi-cpu"></i>
                            </div>
                            <span class="model-name">{{translations.dashboard.selectModel}}</span>
                            <i class="bi bi-chevron-down model-chevron"></i>
                        </button>
                        <input type="hidden" id="actionModel" value="">

                        <!-- Model Dropdown -->
                        <div class="schedule-model-dropdown" id="modelDropdown">
                            <div class="model-dropdown-header">
                                <span>{{translations.dashboard.textToImageModels}}</span>
                            </div>
                            {{#each scheduleModels}}
                            <div class="model-dropdown-item" data-value="{{this.id}}" data-name="{{this.name}}">
                                <div class="model-item-icon">
                                    <i class="bi bi-image"></i>
                                </div>
                                <div class="model-item-info">
                                    <span class="model-item-name">{{this.name}}</span>
                                    <span class="model-item-badge {{#if this.async}}async{{else}}sync{{/if}}">
                                        {{#if this.async}}{{../translations.dashboard.async}}{{else}}{{../translations.dashboard.sync}}{{/if}}
                                    </span>
                                </div>
                                <i class="bi bi-check-lg model-check"></i>
                            </div>
                            {{/each}}
                            {{#if activeSDModels.length}}
                            <div class="model-dropdown-header">
                                <span>{{translations.dashboard.customSDModels}}</span>
                            </div>
                            {{#each activeSDModels}}
                            <div class="model-dropdown-item" data-value="sd-{{this.modelId}}" data-name="{{this.name}}">
                                <div class="model-item-icon sd">
                                    <i class="bi bi-stars"></i>
                                </div>
                                <div class="model-item-info">
                                    <span class="model-item-name">{{this.name}}</span>
                                    <span class="model-item-badge sd">SD</span>
                                </div>
                                <i class="bi bi-check-lg model-check"></i>
                            </div>
                            {{/each}}
                            {{/if}}
                        </div>
                        <small class="text-muted">
                            <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.modelSameAsImageDashboard}}
                        </small>
                    </div>

                    <!-- Test Run Preview Section -->
                    <div class="mb-3" id="testRunSection">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label mb-0">{{translations.dashboard.testRun}}</label>
                            <button type="button" class="btn btn-sm btn-outline-warning" id="testRunBtn" onclick="schedulesDashboard.runTestGeneration()">
                                <i class="bi bi-play-circle me-1"></i>{{translations.dashboard.testRunButton}}
                            </button>
                        </div>
                        <div id="testRunPreview" class="test-run-preview" style="display: none;">
                            <div id="testRunLoading" class="text-center py-4" style="display: none;">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">{{translations.dashboard.generating}}</span>
                                </div>
                                <p class="text-muted mt-2 mb-0">{{translations.dashboard.generatingTestImage}}</p>
                            </div>
                            <div id="testRunResult" style="display: none;">
                                <div class="position-relative">
                                    <img id="testRunImage" src="" alt="Test Result" class="img-fluid rounded mb-2" style="max-height: 300px; width: 100%; object-fit: contain;">
                                    <button type="button" class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2" onclick="schedulesDashboard.expandTestImage()">
                                        <i class="bi bi-arrows-fullscreen"></i>
                                    </button>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted" id="testRunInfo"></small>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="schedulesDashboard.clearTestRun()">
                                        <i class="bi bi-x me-1"></i>{{translations.dashboard.clear}}
                                    </button>
                                </div>
                            </div>
                            <div id="testRunError" class="alert alert-danger mb-0" style="display: none;">
                                <i class="bi bi-exclamation-triangle me-1"></i>
                                <span id="testRunErrorMsg"></span>
                            </div>
                        </div>
                        <small class="text-muted d-block mt-1">
                            <i class="bi bi-lightbulb me-1"></i>{{translations.dashboard.testRunHelp}}
                        </small>
                    </div>

                    <!-- Social Platforms -->
                    <div class="mb-3">
                        <label class="form-label">{{translations.dashboard.autoPublishTo}}</label>
                        <div id="socialAccountsContainer">
                            <div class="text-muted small">
                                <span class="spinner-border spinner-border-sm me-1"></span>
                                {{translations.dashboard.loadingConnectedAccounts}}
                            </div>
                        </div>
                        <div id="noSocialAccountsMessage" class="text-muted small" style="display: none;">
                            <i class="bi bi-info-circle me-1"></i>
                            {{translations.dashboard.noSocialAccountsConnected}}
                            <a href="#" onclick="schedulesDashboard.openConnectionsSettings(); return false;">{{translations.dashboard.connectAccounts}}</a> {{translations.dashboard.toAutoPublish}}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        {{translations.dashboard.cancel}}
                    </button>
                    <button type="button" class="btn btn-primary" onclick="schedulesDashboard.saveSchedule()">
                        <i class="bi bi-check me-1"></i>{{translations.dashboard.save}}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Schedule Modal -->
    <div class="modal fade" id="viewScheduleModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="false">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar-event me-2"></i>{{translations.dashboard.scheduleDetails}}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewScheduleBody">
                    <!-- Content loaded dynamically -->
                </div>
                <div class="modal-footer" id="viewScheduleFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        {{translations.dashboard.close}}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Manager Modal -->
    <div class="modal fade" id="calendarManagerModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="false">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar-week me-2"></i>{{translations.dashboard.publishCalendars}}
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Calendar List -->
                    <div id="calendarListContainer">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <p class="text-muted mb-0">{{translations.dashboard.calendarCreateHelp}}</p>
                            <button class="btn btn-primary btn-sm" onclick="schedulesDashboard.openCreateCalendarModal()">
                                <i class="bi bi-plus me-1"></i>{{translations.dashboard.newCalendar}}
                            </button>
                        </div>
                        <div id="calendarList" class="calendar-list">
                            <!-- Calendars loaded dynamically -->
                            <div class="text-center py-4">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Create/Edit Calendar Form (hidden by default) -->
                    <div id="calendarFormContainer" style="display: none;">
                        <div class="d-flex align-items-center mb-3">
                            <button type="button" class="btn btn-link text-muted p-0 me-2" onclick="schedulesDashboard.showCalendarList()">
                                <i class="bi bi-arrow-left"></i>
                            </button>
                            <h6 class="mb-0" id="calendarFormTitle">{{translations.dashboard.newCalendar}}</h6>
                        </div>

                        <input type="hidden" id="editCalendarId">

                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.calendarName}}</label>
                            <input type="text" class="form-control" id="calendarName" placeholder="{{translations.dashboard.calendarNamePlaceholder}}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.description}} <span class="text-muted">({{translations.dashboard.optional}})</span></label>
                            <input type="text" class="form-control" id="calendarDescription" placeholder="{{translations.dashboard.calendarDescriptionPlaceholder}}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">{{translations.dashboard.timezone}}</label>
                            <select class="form-select" id="calendarTimezone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time (ET)</option>
                                <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                <option value="Europe/London">London (GMT)</option>
                                <option value="Europe/Paris">Paris (CET)</option>
                                <option value="Asia/Tokyo">Tokyo (JST)</option>
                                <option value="Asia/Bangkok">Bangkok (ICT)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label mb-0">{{translations.dashboard.timeSlots}}</label>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="schedulesDashboard.addSlotRow()">
                                    <i class="bi bi-plus me-1"></i>{{translations.dashboard.addSlot}}
                                </button>
                            </div>
                            <div id="slotsContainer" class="slots-container">
                                <!-- Slots added dynamically -->
                            </div>
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>{{translations.dashboard.timeSlotsHelp}}
                            </small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="calendarModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{translations.dashboard.close}}</button>
                </div>
            </div>
        </div>
    </div>

    {{> dashboard-footer}}
    <script>
        window.translations = {{{json translations}}};
    </script>
    <script src="/js/dashboard-schedules.js"></script>
</body>
</html>
