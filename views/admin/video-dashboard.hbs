<!DOCTYPE html>
<html>
{{> dashboard-header}}
<body class="bg-dark">
    {{> dashboard-nav}}
    <link rel="stylesheet" href="/css/dashboard-video.css">
    
    <section class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                    <div class="flex-grow-1">
                        <h1 class="text-white mb-1">
                            <i class="bi bi-film me-2"></i>Video Dashboard
                        </h1>
                        <p class="text-muted mb-0">Generate videos from images with AI models</p>
                    </div>
                    {{#if isAdmin}}
                    <div class="d-flex gap-2 w-100 w-md-auto">
                        <button class="btn btn-outline-info flex-fill flex-md-grow-0" onclick="refreshStats()">
                            <i class="bi bi-arrow-clockwise me-1"></i>Refresh Stats
                        </button>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Panel: Generation Controls -->
            <div class="col-lg-4 mb-4">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-sliders me-2"></i>Generation Settings</h5>
                    </div>
                    <div class="card-body">
                        <!-- Video Generation Mode Selection -->
                        <div class="mb-4">
                            <label class="form-label text-white fw-bold">Generation Mode</label>
                            <div class="segmented-control" role="group">
                                <input type="radio" class="btn-check" name="videoMode" id="video-mode-i2v" value="i2v" checked>
                                <label class="segment-btn" for="video-mode-i2v">
                                    <i class="bi bi-image"></i>
                                    <span>Image to Video</span>
                                </label>
                                
                                <input type="radio" class="btn-check" name="videoMode" id="video-mode-t2v" value="t2v">
                                <label class="segment-btn" for="video-mode-t2v">
                                    <i class="bi bi-card-text"></i>
                                    <span>Text to Video</span>
                                </label>
                                
                                <input type="radio" class="btn-check" name="videoMode" id="video-mode-face" value="face">
                                <label class="segment-btn" for="video-mode-face">
                                    <i class="bi bi-person-bounding-box"></i>
                                    <span>Merge Face</span>
                                </label>
                            </div>
                        </div>

                        <!-- Model Selection -->
                        <div class="mb-4">
                            <label class="form-label text-white fw-bold">Select Video Model</label>
                            
                            <!-- Image to Video Models -->
                            <div class="model-selection" id="i2vModelsSection">
                                <h6 class="text-primary mb-2"><i class="bi bi-image me-1"></i>Image to Video Models</h6>
                                {{#each models}}
                                {{#if (eq this.category "i2v")}}
                                <div class="form-check model-checkbox mb-2">
                                    <input class="form-check-input i2v-model-radio" type="radio" 
                                           name="videoModel"
                                           value="{{this.id}}" 
                                           id="model-{{this.id}}" 
                                           data-model-name="{{this.name}}"
                                           data-category="i2v"
                                           {{#if (eq this.id "kling-v2.1-i2v")}}checked{{/if}}>
                                    <label class="form-check-label text-white" for="model-{{this.id}}">
                                        <span class="fw-semibold">{{this.name}}</span>
                                        <span class="badge bg-info ms-1">Async</span>
                                        <br>
                                        <small class="text-muted">{{this.description}}</small>
                                    </label>
                                </div>
                                {{/if}}
                                {{/each}}
                            </div>
                            
                            <!-- Text to Video Models -->
                            <div class="model-selection mt-3" id="t2vModelsSection" style="display: none;">
                                <h6 class="text-success mb-2"><i class="bi bi-card-text me-1"></i>Text to Video Models</h6>
                                {{#each models}}
                                {{#if (eq this.category "t2v")}}
                                <div class="form-check model-checkbox mb-2">
                                    <input class="form-check-input t2v-model-radio" type="radio" 
                                           name="videoModel"
                                           value="{{this.id}}" 
                                           id="model-{{this.id}}" 
                                           data-model-name="{{this.name}}"
                                           data-category="t2v">
                                    <label class="form-check-label text-white" for="model-{{this.id}}">
                                        <span class="fw-semibold">{{this.name}}</span>
                                        <span class="badge bg-info ms-1">Async</span>
                                        <br>
                                        <small class="text-muted">{{this.description}}</small>
                                    </label>
                                </div>
                                {{/if}}
                                {{/each}}
                            </div>
                            
                            <!-- Video Merge Face Models -->
                            <div class="model-selection mt-3" id="faceModelsSection" style="display: none;">
                                <h6 class="text-warning mb-2"><i class="bi bi-person-bounding-box me-1"></i>Video Face Tools</h6>
                                {{#each models}}
                                {{#if (eq this.category "face")}}
                                <div class="form-check model-checkbox mb-2">
                                    <input class="form-check-input face-model-radio" type="radio" 
                                           name="videoModel"
                                           value="{{this.id}}" 
                                           id="model-{{this.id}}" 
                                           data-model-name="{{this.name}}"
                                           data-category="face">
                                    <label class="form-check-label text-white" for="model-{{this.id}}">
                                        <span class="fw-semibold">{{this.name}}</span>
                                        <span class="badge bg-info ms-1">Async</span>
                                        <br>
                                        <small class="text-muted">{{this.description}}</small>
                                    </label>
                                </div>
                                {{/if}}
                                {{/each}}
                            </div>
                        </div>

                        <!-- Base Image Upload (for I2V) -->
                        <div class="mb-4" id="baseImageSection">
                            <label class="form-label text-white fw-bold">Base Image</label>
                            <div class="base-image-upload" id="imageUploadArea">
                                <input type="file" id="baseImageInput" accept="image/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('baseImageInput').click()">
                                    <i class="bi bi-cloud-upload display-4 text-muted"></i>
                                    <p class="text-muted mb-0">Click to upload image</p>
                                    <small class="text-muted">Supports JPG, PNG, WebP</small>
                                </div>
                                <div class="image-preview d-none" id="imagePreview">
                                    <img id="previewImg" src="" alt="Preview" class="img-fluid rounded">
                                    <button class="btn btn-sm btn-danger mt-2" onclick="clearImageUpload()">
                                        <i class="bi bi-x me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Video Merge Face Section (hidden by default) -->
                        <div class="mb-4" id="videoMergeFaceSection" style="display: none;">
                            <label class="form-label text-white fw-bold">Source Video</label>
                            <div class="base-image-upload mb-3" id="videoUploadArea">
                                <input type="file" id="baseVideoInput" accept="video/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('baseVideoInput').click()">
                                    <i class="bi bi-film display-4 text-muted"></i>
                                    <p class="text-muted mb-0">Click to upload video</p>
                                    <small class="text-muted">Supports MP4, MOV, WebM</small>
                                </div>
                                <div class="video-preview d-none" id="videoPreview">
                                    <video id="previewVideo" controls class="img-fluid rounded" style="max-height: 150px;">
                                        <source id="previewVideoSource" src="" type="video/mp4">
                                    </video>
                                    <button class="btn btn-sm btn-danger mt-2" onclick="clearVideoUpload()">
                                        <i class="bi bi-x me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                            
                            <label class="form-label text-white fw-bold">Face Image (to merge)</label>
                            <div class="base-image-upload" id="faceImageUploadArea">
                                <input type="file" id="faceImageInput" accept="image/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('faceImageInput').click()">
                                    <i class="bi bi-person-circle display-4 text-muted"></i>
                                    <p class="text-muted mb-0">Click to upload face image</p>
                                    <small class="text-muted">The face to apply to the video</small>
                                </div>
                                <div class="image-preview d-none" id="faceImagePreview">
                                    <img id="facePreviewImg" src="" alt="Face Preview" class="img-fluid rounded">
                                    <button class="btn btn-sm btn-danger mt-2" onclick="clearFaceImageUpload()">
                                        <i class="bi bi-x me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Video Parameters -->
                        <div class="mb-4">
                            <label class="form-label text-white fw-bold">Duration</label>
                            <select class="form-select bg-secondary text-white border-secondary" id="durationSelect">
                                {{#each durationOptions}}
                                <option value="{{this.value}}">{{this.label}}</option>
                                {{/each}}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label text-white fw-bold">Aspect Ratio</label>
                            <select class="form-select bg-secondary text-white border-secondary" id="aspectRatioSelect">
                                {{#each aspectRatioOptions}}
                                <option value="{{this.value}}">{{this.label}}</option>
                                {{/each}}
                            </select>
                        </div>

                        <!-- Wan 2.2 I2V Fast (Segmind) Options -->
                        <div id="segmindWanOptions" style="display: none;">
                            <hr class="border-secondary my-3">
                            <h6 class="text-info mb-3"><i class="bi bi-gear-fill me-2"></i>Wan 2.2 I2V Fast Options</h6>
                            
                            <!-- Go Fast Toggle -->
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="goFastToggle" checked>
                                    <label class="form-check-label text-white" for="goFastToggle">
                                        <span class="fw-bold">Go Fast Mode</span>
                                        <br><small class="text-muted">Faster generation (recommended)</small>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Number of Frames -->
                            <div class="mb-3">
                                <label class="form-label text-white fw-bold">Number of Frames</label>
                                <div class="d-flex align-items-center gap-2">
                                    <input type="range" class="form-range flex-grow-1" id="numFramesRange" min="81" max="100" value="81">
                                    <span class="badge bg-info" id="numFramesValue">81</span>
                                </div>
                                <small class="text-muted">More frames = smoother video (81-100)</small>
                            </div>
                            
                            <!-- Resolution -->
                            <div class="mb-3">
                                <label class="form-label text-white fw-bold">Resolution</label>
                                <select class="form-select bg-secondary text-white border-secondary" id="segmindResolutionSelect">
                                    <option value="480p" selected>480p (Faster)</option>
                                    <option value="720p">720p (Higher Quality)</option>
                                </select>
                            </div>
                            
                            <!-- Frames Per Second -->
                            <div class="mb-3">
                                <label class="form-label text-white fw-bold">Frames Per Second</label>
                                <div class="d-flex align-items-center gap-2">
                                    <input type="range" class="form-range flex-grow-1" id="fpsRange" min="5" max="24" value="16">
                                    <span class="badge bg-info" id="fpsValue">16</span>
                                </div>
                                <small class="text-muted">16 fps recommended for optimal balance</small>
                            </div>
                            
                            <!-- Negative Prompt -->
                            <div class="mb-3">
                                <label class="form-label text-white fw-bold">Negative Prompt (Optional)</label>
                                <textarea class="form-control bg-secondary text-white border-secondary" 
                                          id="negativePromptInput" 
                                          rows="2" 
                                          placeholder="Describe what to avoid (e.g., blurry, low quality, distorted)..."></textarea>
                            </div>
                            
                            <!-- Last Image (Optional) -->
                            <div class="mb-3">
                                <label class="form-label text-white fw-bold">End Frame Image (Optional)</label>
                                <div class="base-image-upload" id="lastImageUploadArea">
                                    <input type="file" id="lastImageInput" accept="image/*" style="display: none;">
                                    <div class="upload-placeholder small" onclick="document.getElementById('lastImageInput').click()">
                                        <i class="bi bi-image display-6 text-muted"></i>
                                        <p class="text-muted mb-0 small">Optional: Upload end frame</p>
                                        <small class="text-muted">Guide video towards specific final frame</small>
                                    </div>
                                    <div class="image-preview d-none" id="lastImagePreview">
                                        <img id="lastPreviewImg" src="" alt="End Frame Preview" class="img-fluid rounded" style="max-height: 100px;">
                                        <button class="btn btn-sm btn-danger mt-2" type="button" onclick="clearLastImageUpload()">
                                            <i class="bi bi-x me-1"></i>Clear
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Motion Prompt -->
                        <div class="mb-4">
                            <label class="form-label text-white fw-bold">Motion Prompt (Optional)</label>
                            <textarea class="form-control bg-secondary text-white border-secondary" 
                                      id="promptInput" 
                                      rows="8" 
                                      placeholder="Describe the motion or camera movement (e.g., slow zoom in, camera pans left, dramatic lighting)..."
                                      style="min-height: 120px;">Dynamic camera movement with natural motion</textarea>
                            <div class="form-text text-muted mt-1">
                                <small><i class="bi bi-info-circle me-1"></i>Leave empty for automatic motion detection</small>
                            </div>
                        </div>

                        <!-- Cost Display -->
                        <div class="mb-3 rounded-4 overflow-hidden" id="costDisplaySection" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid rgba(255,255,255,0.1);">
                            <div class="p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px; background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);">
                                            <i class="bi bi-film text-white"></i>
                                        </div>
                                        <div>
                                            <div class="text-white-50 small">Video Cost</div>
                                            <div class="text-white fw-bold fs-5" id="totalCostDisplay">{{videoCostPerUnit}}</div>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <div class="text-white-50 small">Your Balance</div>
                                        <div class="fw-bold fs-5" id="userPointsDisplay" style="color: #4ade80;">{{userPoints}}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="px-3 py-2" style="background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05);">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="text-white-50 small">
                                        <i class="bi bi-info-circle me-1"></i>
                                        Per video generation
                                    </span>
                                    <span class="badge rounded-pill" id="costStatusBadge" style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: #000;">
                                        <i class="bi bi-check-circle-fill me-1"></i>Ready
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button class="btn btn-primary btn-lg w-100" id="generateBtn" onclick="startGeneration()">
                            <i class="bi bi-play-fill me-2"></i>Generate Video
                        </button>
                    </div>
                </div>
            </div>

            <!-- Center Panel: Results -->
            <div class="{{#if isAdmin}}col-lg-5{{else}}col-lg-8{{/if}} mb-4">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-film me-2"></i>Generation Results</h5>
                        <span id="totalTimeDisplay" class="badge bg-light text-dark d-none">Total: 0s</span>
                    </div>
                    <div class="card-body" id="resultsContainer" style="min-height: 400px; max-height: 600px; overflow-y: auto;">
                        <div class="text-center text-muted py-5" id="noResultsPlaceholder">
                            <i class="bi bi-film display-1"></i>
                            <p class="mt-3">Upload an image and click "Generate Video" to begin</p>
                        </div>
                    </div>
                </div>
            </div>

            {{#if isAdmin}}
            <!-- Right Panel: Statistics (Admin Only) -->
            <div class="col-lg-3 mb-4">
                <div class="card bg-dark border-secondary">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Model Statistics</h5>
                    </div>
                    <div class="card-body" id="statsContainer">
                        {{#each models}}
                        <div class="stat-card mb-3 p-3 rounded" data-model-id="{{this.id}}">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="text-white mb-0">{{this.name}}</h6>
                                <span class="badge bg-secondary">{{this.totalTests}} tests</span>
                            </div>
                            <div class="row text-center mb-2">
                                <div class="col-4">
                                    <small class="text-muted d-block">Avg</small>
                                    <span class="text-info fw-bold stat-avg">
                                        {{#if this.averageTime}}
                                        {{divide this.averageTime 1000}}s
                                        {{else}}
                                        --
                                        {{/if}}
                                    </span>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Min</small>
                                    <span class="text-success fw-bold stat-min">
                                        {{#if this.minTime}}
                                        {{divide this.minTime 1000}}s
                                        {{else}}
                                        --
                                        {{/if}}
                                    </span>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Max</small>
                                    <span class="text-danger fw-bold stat-max">
                                        {{#if this.maxTime}}
                                        {{divide this.maxTime 1000}}s
                                        {{else}}
                                        --
                                        {{/if}}
                                    </span>
                                </div>
                            </div>
                            {{#if this.averageRating}}
                            <div class="text-center mt-2 pt-2 border-top border-secondary">
                                <small class="text-muted d-block mb-1">Average Rating</small>
                                <div class="d-flex justify-content-center align-items-center gap-1">
                                    <span class="text-warning fw-bold stat-rating">{{this.averageRating}}</span>
                                    <i class="bi bi-star-fill text-warning"></i>
                                    <small class="text-muted">({{this.totalRatings}} ratings)</small>
                                </div>
                            </div>
                            {{/if}}
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>
            {{/if}}
        </div>

        <!-- Test History -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card bg-dark border-secondary">
                    <div class="card-header bg-secondary text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>{{#if isAdmin}}Recent Test History{{else}}Your Generation History{{/if}}</h5>
                            <button class="btn btn-sm btn-outline-light" onclick="loadHistory()">
                                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-dark table-hover" id="historyTable">
                            <thead>
                                <tr>
                                    <th style="width: 120px;">Video</th>
                                    <th>Model</th>
                                    <th>Prompt</th>
                                    <th>Duration</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                {{#each recentTests}}
                                <tr>
                                    <td>
                                        {{#if this.videos.length}}
                                        <video class="history-video cursor-pointer" 
                                               onclick="previewHistoryVideo('{{this.videos.[0].videoUrl}}', '{{this.modelName}}', {{this.generationTime}}, '{{this._id}}')"
                                               muted>
                                            <source src="{{this.videos.[0].videoUrl}}" type="video/mp4">
                                        </video>
                                        {{else}}
                                        <span class="text-muted">--</span>
                                        {{/if}}
                                    </td>
                                    <td>{{this.modelName}}</td>
                                    <td>
                                        <span class="text-truncate" style="max-width: 200px; display: inline-block;" title="{{this.prompt}}">{{this.prompt}}</span>
                                    </td>
                                    <td>{{this.params.duration}}s</td>
                                    <td>{{#if this.generationTime}}{{divide this.generationTime 1000}}s{{else}}--{{/if}}</td>
                                    <td>
                                        {{#if (eq this.status "completed")}}
                                        <span class="badge bg-success">Completed</span>
                                        {{else if (eq this.status "failed")}}
                                        <span class="badge bg-danger">Failed</span>
                                        {{else}}
                                        <span class="badge bg-warning">{{this.status}}</span>
                                        {{/if}}
                                    </td>
                                    <td>{{formatDate this.testedAt}}</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Video Preview Modal -->
    <div class="modal fade" id="videoPreviewModal" tabindex="-1" aria-labelledby="videoPreviewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="videoPreviewModalLabel">Video Preview</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center" style="overflow-y: auto; max-height: 80vh;">
                    <video id="modalPreviewVideo" controls autoplay class="img-fluid rounded" style="max-height: 60vh;">
                        <source id="modalPreviewVideoSource" src="" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="mt-3">
                        <p id="previewModelName" class="mb-1"></p>
                        <p id="previewTime" class="text-muted mb-0"></p>
                        <p id="previewPrompt" class="text-secondary small mt-2 mb-0" style="display: none;"></p>
                        <div class="mt-3">
                            <label class="form-label text-white mb-2">Rate this video:</label>
                            <div class="rating-stars d-flex justify-content-center gap-1" id="ratingStars">
                                <i class="bi bi-star rating-star" data-rating="1" data-bs-toggle="tooltip" title="1 star"></i>
                                <i class="bi bi-star rating-star" data-rating="2" data-bs-toggle="tooltip" title="2 stars"></i>
                                <i class="bi bi-star rating-star" data-rating="3" data-bs-toggle="tooltip" title="3 stars"></i>
                                <i class="bi bi-star rating-star" data-rating="4" data-bs-toggle="tooltip" title="4 stars"></i>
                                <i class="bi bi-star rating-star" data-rating="5" data-bs-toggle="tooltip" title="5 stars"></i>
                            </div>
                            <small class="text-muted d-block mt-2" id="ratingStatus">Click a star to rate</small>
                        </div>
                        <!-- Save as Draft Post Section -->
                        <div class="mt-4 pt-3 border-top border-secondary">
                            <div class="d-flex justify-content-center gap-2 flex-wrap">
                                <button class="btn btn-outline-primary" id="saveAsDraftBtn" onclick="saveAsDraftPost()">
                                    <i class="bi bi-file-earmark-plus me-1"></i>Save as Draft Post
                                </button>
                                <button class="btn btn-outline-info" id="addToCharacterBtn" onclick="openAddVideoToCharacterModal()">
                                    <i class="bi bi-person-video3 me-1"></i>Add to Character
                                </button>
                            </div>
                            <small class="text-muted d-block mt-2">
                                Save to My Posts or add to a character's video gallery
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save as Draft Modal -->
    <div class="modal fade" id="saveDraftModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">
                        <i class="bi bi-file-earmark-plus me-2"></i>Save as Draft Post
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <video id="draftPreviewVideo" controls class="img-fluid rounded mb-3" style="max-height: 200px;">
                            <source id="draftPreviewVideoSource" src="" type="video/mp4">
                        </video>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Caption</label>
                        <textarea class="form-control bg-secondary text-white border-secondary" id="draftCaptionText" rows="8" placeholder="Enter a caption for your post..."></textarea>
                        <small class="text-muted">A caption will be auto-generated if left empty</small>
                    </div>
                    <div class="row g-2 mb-3">
                        <div class="col-md-6">
                            <label class="form-label small">Style</label>
                            <select class="form-select form-select-sm bg-secondary text-white border-secondary" id="draftCaptionStyle">
                                <option value="engaging" selected>Engaging</option>
                                <option value="casual">Casual</option>
                                <option value="professional">Professional</option>
                                <option value="funny">Funny</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small">Language</label>
                            <select class="form-select form-select-sm bg-secondary text-white border-secondary" id="draftCaptionLanguage">
                                <option value="english">üá¨üáß English</option>
                                <option value="japanese">üáØüáµ Êó•Êú¨Ë™û</option>
                                <option value="french">üá´üá∑ Fran√ßais</option>
                                <option value="portuguese">üáßüá∑ Portugu√™s</option>
                                <option value="spanish">üá™üá∏ Espa√±ol</option>
                                <option value="chinese">üá®üá≥ ‰∏≠Êñá</option>
                                <option value="korean">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                                <option value="thai">üáπüá≠ ‡πÑ‡∏ó‡∏¢</option>
                                <option value="german">üá©üá™ Deutsch</option>
                                <option value="italian">üáÆüáπ Italiano</option>
                                <option value="russian">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                <option value="hindi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-info btn-sm" id="generateCaptionBtn" onclick="generateDraftCaption()">
                            <i class="bi bi-magic me-1"></i>Generate Caption with AI
                        </button>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="confirmSaveDraftBtn" onclick="confirmSaveDraft()">
                        <i class="bi bi-check me-1"></i>Save Draft
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Video to Character Modal -->
    <div class="modal fade" id="addVideoToCharacterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">
                        <i class="bi bi-person-video3 me-2"></i>Add Video to Character
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-5 mb-3">
                            <video id="videoCharacterPreview" controls class="img-fluid rounded" style="max-height: 200px;">
                                <source id="videoCharacterPreviewSource" src="" type="video/mp4">
                            </video>
                            <p class="text-muted small mt-2" id="videoPromptPreview"></p>
                        </div>
                        <div class="col-md-7">
                            <div class="mb-3">
                                <label class="form-label">Search Character</label>
                                <div class="input-group">
                                    <input type="text" class="form-control bg-secondary text-white border-secondary" 
                                           id="videoCharacterSearchInput" placeholder="Search by name...">
                                    <button class="btn btn-primary" type="button" onclick="searchCharactersForVideo()">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="video-character-search-results" id="videoCharacterSearchResults" style="max-height: 300px; overflow-y: auto;">
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-person-circle display-4"></i>
                                    <p class="mt-2">Search for a character to add this video to</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-info" id="confirmAddVideoToCharacterBtn" onclick="confirmAddVideoToCharacter()" disabled>
                        <i class="bi bi-plus-lg me-1"></i>Add Video to Character
                    </button>
                </div>
            </div>
        </div>
    </div>

    {{> dashboard-footer}}
    <script>
        // Pricing configuration passed from server
        window.PRICING = {
            videoCostPerUnit: {{videoCostPerUnit}},
            userPoints: {{userPoints}}
        };
    </script>
    <script src="/js/dashboard-video.js"></script>
</body>
</html>
